extends layout

block title
  - place='pastQueries'
  meta(name='robots' content='noindex')
  title #{__("Past query")} - #{__("Jianpu Space")}

block scripts
  script(src="../javascripts/sound.js")
  script(src="../javascripts/pastQueriesQbsh.js")

block content
  h1 #{__("Past query")}
  div #{__("Query audio:")}
    audio(controls=true)
      source(src='../savedQueries/'+query+'.wav', type="audio/wav")
  if result && result.pitch
    p #{__("Pitch sequence:")}
      span#pitchSeq [#{result.pitch.join(', ')}]
      br
      button.button.blue(onclick='playPitch()') #{__("Play pitch")}
    audio#keepAudioCtx(loop src="../sounds/blank.mp3")
  if result && result.songs
    ol
      for i in result.songs
        li
          - var range='';
          - if (i.From!=null && i.To!=null) range=`#qbshfrom=${i.From}&qbshto=${i.To}`;
          a(href='../songList/'+i.file+range)= i.name
          if i.singer
            | #{__(",") + __("Singer") + __(":")}
            span #{i.singer}
          | #{__(",") + __("Similarity") + __(":")}#{i.score}
    p #{result.reason}
  else
    p #{JSON.stringify(result)}
