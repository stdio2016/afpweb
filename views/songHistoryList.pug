extends layout

block title
  meta(name='robots' content='noindex,nofollow')
  if song
    title 歌曲 #{song.name} 的修訂歷史 - 簡譜空間
  else
    title 找不到歌曲 - 簡譜空間

block content
  if song
    h1 歌曲 #{song.name} 的修訂歷史
    ul
      for rev in revisions
        li
          a(href=PREFIX+'/songList/history?songID='+song.id+'&rev='+rev.rev)
            span.date #{+rev.modify_time}
          |  
          -
            var user = rev.user;
            var username = 'no ip record';
            if (user) {
              if (user.name) username = user.name;
              else if (user.ip) username = user.ip;
            }
            var incr = rev.compare.increased;
            var com = rev.compare || {}, comout = [];
            if (com.added && com.added.length > 0)
              comout.push('新增 '+com.added.join('、'));
            if (com.edited && com.edited.length > 0)
              comout.push('編輯 '+com.edited.join('、'));
            if (com.deleted && com.deleted.length > 0)
              comout.push('刪除 '+com.deleted.join('、'));
          span #{username}
          |  
          span (#{rev.compare.size}字元)
          |  
          if incr > 0
            span.add (+#{incr})
          else if incr == 0
            span (0)
          else
            span.less (#{incr})
          |  
          span #{comout.join('、')}
  else
    h1 找不到歌曲
    p 可能是這首歌曲被刪除了，或者是您輸入錯網址了。
    p 
      | 您可以按
      a(href=PREFIX+'/songList') 這裡
      | ，尋找其他歌曲
  script.
    document.querySelectorAll('.date').forEach(function(x){
      x.textContent = new Date(parseInt(x.textContent)).toLocaleString();
    });
